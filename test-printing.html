<!DOCTYPE html>
<html>
<head>
    <title>Test Clean Printing System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #005a87;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üß™ Clean Printing System Test</h1>
    
    <div class="test-section">
        <h3>üìã Test Order Data</h3>
        <p>This will test the new clean printing system with sample order data.</p>
        <button onclick="testCleanPrinting()">üñ® Test Print Order</button>
        <div id="status" class="status info">Ready to test...</div>
    </div>
    
    <div class="test-section">
        <h3>üìÑ Print Preview</h3>
        <p>View the generated HTML before printing:</p>
        <button onclick="showBillPreview()">üëÅ Preview Customer Bill</button>
        <button onclick="showKOTPreview()">üëÅ Preview Kitchen KOT</button>
    </div>

    <script>
        // Import the clean printing system
        const CleanPrintingSystem = require('./src/utils/cleanPrintingSystem');
        const cleanPrinter = new CleanPrintingSystem();

        // Sample test data
        const testOrderData = {
            items: [
                { id: 'item1', name: 'Masala Dosa', price: 60, quantity: 2, total: 120, type: 'food' },
                { id: 'item2', name: 'Filter Coffee', price: 25, quantity: 1, total: 25, type: 'drinks' },
                { id: 'item3', name: 'Vada Sambar', price: 40, quantity: 1, total: 40, type: 'food' }
            ],
            menuItems: {
                'item1': { name: 'Masala Dosa', price: 60, category: 'South Indian', type: 'food' },
                'item2': { name: 'Filter Coffee', price: 25, category: 'Beverages', type: 'drinks' },
                'item3': { name: 'Vada Sambar', price: 40, category: 'South Indian', type: 'food' }
            },
            location: {
                type: 'table',
                number: 5
            },
            serviceCharge: 10,
            restaurant: {
                name: 'Udupi Restaurant',
                address: '123 Main Street, City',
                phone: '+91 98765 43210',
                gstin: '29ABCDE1234F1Z5',
                fssai: '12345678901234'
            }
        };

        async function testCleanPrinting() {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = 'üîÑ Testing clean printing system...';
            statusDiv.className = 'status info';

            try {
                console.log('üöÄ Starting clean printing test...');
                const result = await cleanPrinter.printCompleteOrder(testOrderData);
                
                if (result.success) {
                    statusDiv.textContent = '‚úÖ Print test successful! Check your printer output.';
                    statusDiv.className = 'status success';
                    console.log('‚úÖ Clean printing test passed:', result);
                } else {
                    statusDiv.textContent = '‚ùå Print test failed: ' + (result.error || 'Unknown error');
                    statusDiv.className = 'status error';
                    console.error('‚ùå Clean printing test failed:', result);
                }
            } catch (error) {
                statusDiv.textContent = '‚ùå Test error: ' + error.message;
                statusDiv.className = 'status error';
                console.error('‚ùå Clean printing test error:', error);
            }
        }

        async function showBillPreview() {
            try {
                const billHTML = cleanPrinter.generateCustomerBillHTML(testOrderData.items, testOrderData);
                const previewWindow = window.open('', '_blank', 'width=400,height=600,scrollbars=yes');
                previewWindow.document.write(billHTML);
                previewWindow.document.close();
                previewWindow.document.title = 'Customer Bill Preview';
            } catch (error) {
                alert('Preview error: ' + error.message);
            }
        }

        async function showKOTPreview() {
            try {
                const kotHTML = cleanPrinter.generateKOTHTML(testOrderData.items, testOrderData, 'Kitchen KOT');
                const previewWindow = window.open('', '_blank', 'width=400,height=600,scrollbars=yes');
                previewWindow.document.write(kotHTML);
                previewWindow.document.close();
                previewWindow.document.title = 'Kitchen KOT Preview';
            } catch (error) {
                alert('Preview error: ' + error.message);
            }
        }

        console.log('üß™ Clean Printing Test Page Loaded');
        console.log('üì¶ Test data prepared:', testOrderData);
    </script>
</body>
</html>
